<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>        
        <script src="https://www.gstatic.com/firebasejs/5.5.5/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.5.5/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.5.5/firebase.js"></script>
        <link href="../css/card.css" rel="stylesheet">
        <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <script src="../bootstrap/js/bootstrap.min.js"></script>
        <script src="../jquery/jquery.maskMoney.js"></script>
        <title>ギルドバトル戦績</title> 
        </head>
        <body>
    
    <!-- モーダルダイアログ -->
    <div class="modal fade" id="InputProcessDialog" tabindex="-1" role="dialog" aria-labelledby="modal" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title card-strong" id="demoModalTitle"><label id="when" ></label></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input id="guildBattleDate" style="margin-bottom:10px;" type="date"  required/>
                    <table class="table table-hover" style="width:100%;">
                        <tr><td><input type="text" placeholder="ギルド名" id="input-guildname-yellow"/></td><td><input type="text" placeholder="Gp" id="input-gp-yellow"/></tr>
                        <tr><td><input type="text" placeholder="ギルド名" id="input-guildname-red"/></td><td><input type="text" placeholder="Gp" id="input-gp-red"/></tr>
                        <tr><td><input type="text" placeholder="ギルド名" id="input-guildname-green"/></td><td><input type="text" placeholder="Gp" id="input-gp-green"/></tr>
                        <tr><td><input type="text" placeholder="ギルド名" id="input-guildname-blue"/></td><td><input type="text" placeholder="Gp" id="input-gp-blue"/></tr>
                    </table>

                    <textarea placeholder="comment" style="width:90%;height: 150px;"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn card-buton" id="InputProcessSubmit">更新</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">閉じる</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        ////////////////////////////////////////////
        // 機能 : 戦績入力モーダル表示時、親画面から引数を渡す
        ////////////////////////////////////////////
        $("#InputProcessDialog").on("show.bs.modal", function(event){
            // 起動ボタンから、入力引数を取得
            var raiseButton = $(event.relatedTarget);
            var when = raiseButton.data("when");

            var modal = $(this);
            modal.find("#when").text(when);
        });

        ////////////////////////////////////////////
        // 機能 : 戦績入力モーダルの「Gp」を桁区切りで表示
        ////////////////////////////////////////////
        $("#input-gp-yellow").maskMoney({thousands:',',allowZero: true,precision: '0'});
        $("#input-gp-red").maskMoney({thousands:',',allowZero: true,precision: '0'});
        $("#input-gp-green").maskMoney({thousands:',',allowZero: true,precision: '0'});
        $("#input-gp-blue").maskMoney({thousands:',',allowZero: true,precision: '0'});

        ////////////////////////////////////////////
        // 機能 : 戦績入力モーダルから更新ボタン押下時、子画面へデータを渡す
        ////////////////////////////////////////////
        $("#InputProcessSubmit").on("click",function(event){

            var when = $("#when").text();
            var guildName = when + "-guildname-";
            var gp = when + "-gp-";

            $("#label-" + guildName + "yellow").text(  $("#input-guildname-yellow").val() )
            $("#label-" + gp + "yellow").text(  $("#input-guildname-yellow").val() )

            $("#label-guildname-red").text(  $("#input-guildname-red").val() )
            $("#label-gp-red").text(  $("#input-gp-red").val() )

            $("#label-guildname-green").text(  $("#input-guildname-green").val() )
            $("#label-gp-green").text(  $("#input-gp-green").val() )

            $("#label-guildname-blue").text(  $("#input-guildname-blue").val() )
            $("#label-gp-blue").text(  $("#input-gp-blue").val() )

        });
    </script>
        <div class="contanier">
            <p class="offset-lg-1" ><strong>日付</strong>
                <input id="guildBattleDate" type="date"  required/>
            </p>
                <div class="row col-lg-10 offset-lg-1">
                    <div class="col-lg-3">
                        <div class="card flex-md-row mb-4 box-shadow h-md-250" style="border-color : darkorchid; border-width:2px">
                            <div class="card-body d-flex flex-column align-items-start" >
                                <div style="width:100%">
                                    <b class="d-inline-block mb-2 card-strong" >Moring</b> 
                                    <input type="button" class="btn card-buton" style="float:right;" data-toggle="modal" data-when="morning" data-target="#InputProcessDialog" value="入力" />
                                </div>
                                <div class="table-responsive">
                                    <table class="table" style="width:100%;">
                                        <tr><th>ギルド名</th> <th>GP</th></tr>
                                        <tr><td><label id="label-morning-guildname-yellow"/></td><td><label id="label-morning-gp-yellow"/></tr>
                                        <tr><td><label id="label-morning-guildname-red"/></td><td><label id="label-morning-gp-red"/></tr>
                                        <tr><td><label id="label-morning-guildname-green"/></td><td><label id="label-morning-gp-green"/></tr>
                                        <tr><td><label id="label-morning-guildname-blue"/></td><td><label id="label-morning-gp-blue"/></tr>
                                    </table>
                                    </div>
                                <label id="label-gp-yellow"></label>
                                <h3 class="mb-0">
                                <a class="text-dark" href="#">Featured post</a>
                                </h3>
                                <div class="mb-1 text-muted">Nov 12</div>
                                <p class="card-text mb-auto">This is a wider card with supporting text below as a natural lead-in to additional content.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card flex-md-row mb-4 box-shadow h-md-250" style="border-color : darkorchid; border-width:2px">
                            <div class="card-body d-flex flex-column align-items-start">
                                <div style="width:100%">
                                        <b class="d-inline-block mb-2 card-strong" >Noon</b> 
                                        <input type="button" class="btn card-buton"  style="float:right;" data-toggle="modal" data-target="#InputProcessDialog" value="入力" />
                                    </div>
                                    <h3 class="mb-0">
                                <a class="text-dark" href="#">Post title</a>
                                </h3>
                                <div class="mb-1 text-muted">Nov 11</div>
                                <p class="card-text mb-auto">This is a wider card with supporting text below as a natural lead-in to additional content.</p>
                                <a href="#">Continue reading</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card flex-md-row mb-4 box-shadow h-md-250" style="border-color: darkorchid; border-width:2px">
                            <div class="card-body d-flex flex-column align-items-start">
                            <div style="width:100%">
                                    <b class="d-inline-block mb-2 card-strong" >Evening</b> 
                                    <input type="button" class="btn card-buton"  style="float:right;" data-toggle="modal" data-target="#InputProcessDialog" value="入力" />
                                </div>
                            <h3 class="mb-0">
                                <a class="text-dark" href="#">Post title</a>
                            </h3>
                            <div class="mb-1 text-muted">Nov 11</div>
                            <p class="card-text mb-auto">This is a wider card with supporting text below as a natural lead-in to additional content.</p>
                            <a href="#">Continue reading</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card flex-md-row mb-4 box-shadow h-md-250" style="border-color: darkorchid; border-width:2px">
                            <div class="card-body d-flex flex-column align-items-start">
                            <div style="width:100%">
                                    <b class="d-inline-block mb-2 card-strong" >Night</b> 
                                    <input type="button" class="btn card-buton"  style="float:right;" data-toggle="modal" data-target="#InputProcessDialog" value="入力" />
                                </div>
                            <h3 class="mb-0">
                                <a class="text-dark" href="#">Post title</a>
                            </h3>
                            <div class="mb-1 text-muted">Nov 11</div>
                            <p class="card-text mb-auto">This is a wider card with supporting text below as a natural lead-in to additional content.</p>
                            <a href="#">Continue reading</a>
                            </div>
                        </div>
                    </div>
                </div>
        <script>
            function dateFormat(date)
            {
                return date.getFullYear() + "-" +
                    ( "0"+( date.getMonth()+1 ) ).slice(-2)+ "-" +
                    ( "0"+date.getDate() ).slice(-2);
                
            }
                $(function(){
                    $(document).ready(function()
                    {
                        var now = new Date();
                        var yyyymmdd = dateFormat(now);
                        $("#guildBattleDate").val(yyyymmdd);
                    });

                    $("#send").on("click", function(e){

                    var guildBattleDate = $("#guildBattleDate").val();
                    var commentsRef = firebase.database().ref('/guildBattle');
                    commentsRef.set({ Date: guildBattleDate });                       
                    });
                });
                </script>
        </body>
</html>